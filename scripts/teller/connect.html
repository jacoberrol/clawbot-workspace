<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Connect Chase to Teller</title>
  <style>
    body { font-family: system-ui, sans-serif; max-width: 500px; margin: 80px auto; text-align: center; color: #333; }
    h1 { font-size: 1.5rem; margin-bottom: 0.5rem; }
    p { color: #666; margin-bottom: 2rem; }
    button { background: #1a73e8; color: white; border: none; padding: 14px 32px; border-radius: 8px; font-size: 1rem; cursor: pointer; }
    button:hover { background: #1558b0; }
    #result { margin-top: 2rem; padding: 1rem; background: #f0f7f0; border-radius: 8px; display: none; word-break: break-all; }
    #result h2 { color: #2e7d32; margin-top: 0; }
    #error { margin-top: 2rem; padding: 1rem; background: #fdf0f0; border-radius: 8px; display: none; color: #c62828; }
  </style>
</head>
<body>
  <h1>üè¶ Connect Your Chase Account</h1>
  <p>Click below to securely link your Chase account via Teller.<br>Read-only access only ‚Äî we can never move money.</p>

  <button onclick="openTeller()">Connect Chase</button>

  <div id="result">
    <h2>‚úÖ Connected!</h2>
    <p>Your access token:</p>
    <code id="token"></code>
    <br><br>
    <p>Copy this token and paste it into the terminal where Bot is waiting.</p>
  </div>

  <div id="error">
    <strong>Something went wrong:</strong>
    <p id="errorMsg"></p>
  </div>

  <script src="https://cdn.teller.io/connect/connect.js"></script>
  <script>
    // Replace with your actual Teller Application ID
    const APP_ID = document.currentScript ? null : null; // set by server

    function openTeller() {
      const appId = window.TELLER_APP_ID;
      if (!appId) {
        document.getElementById('error').style.display = 'block';
        document.getElementById('errorMsg').textContent = 'App ID not set. Make sure you ran the setup server.';
        return;
      }

      const teller = TellerConnect.setup({
        applicationId: appId,
        environment: "development",
        onSuccess: function(enrollment) {
          document.getElementById('token').textContent = enrollment.accessToken;
          document.getElementById('result').style.display = 'block';

          // Also POST it to local server so Bot can capture it automatically
          fetch('/token', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ access_token: enrollment.accessToken }),
          }).catch(() => {});
        },
        onExit: function() {
          console.log('Teller Connect closed');
        },
        onFailure: function(err) {
          document.getElementById('error').style.display = 'block';
          document.getElementById('errorMsg').textContent = JSON.stringify(err);
        }
      });
      teller.open();
    }
  </script>
</body>
</html>
